<!--
 * @Author: your name
 * @Date: 2020-01-01 22:13:53
 * @LastEditTime : 2020-01-02 16:23:27
 * @LastEditors  : Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \beixiang_ly\LY_Restart\dayTask\20200101\1.md
 -->
# 线程和进程的区别 【廖雪峰的多线程】。
有一点我们应该都显而易见，我们现代的操作系统都可以执行多任务。多任务就是同时运行多个任务，例如我们可以边用QQ音乐听歌又可以用QQ边聊天。
但其实CPU执行代码都是一条一条顺序执行的。既然是顺序执行，那为什么即使是单核CPU，也是可以同时运行多个任务的？
这是因为操作系统执行多任务实际上就是让CPU对[多个任务轮流交替执行]！例如，让QQ音乐执行0.001s，又去让QQ执行0.001s。这种极短时间内的交替执行，就会造成同时执行多任务的假象。
主要注意的是，即使是多核CPU，因为通常任务的数量远远多于CPU的核数，所以任务也是交替执行的。

  * 了解一下[进程] & [线程]：
      在计算机中，我们把一个任务称为一个[进程]，浏览器就是一个进程，视频播放器是另一个进程，类似的，音乐播放器和word都是进程。
      某些进程内部还需要同时执行多个子任务，我们把这些子任务叫做[线程]。
      例如，我们在使用word时，word可以让我们一边打字，一边进行字数检查什么的，有时候你有需要先打印的文件，还可以后台进行文件打印。

      进程和线程的关系： 进程(1) -> 线程(n,n>=1);

      * 操作系统调度的最小任务单元其实不是进程，而是线程。
      常用的windows，Linux等操作系统都采用抢占式多任务，如何调度线程完全由操作系统决定，因为程序自己并不能决定什么时候执行，以及执行多长时间。

      * 因为同一个应用程序，即可以有多个进程，也可以有多个线程，因此，实现多任务的方法，有以下几种：
          - 多进程(多个进程，每个进程里面只有一个线程)：
              (process -> thread) * n
          - 多线程(一个进程里面有多个线程)：
              process -> thread * n
          - 多进程+多线程(多个进程，一个进程里面多个线程)：
              (process -> thread * n) * n

  * 进程 VS 线程 （多任务用哪个方式实现更好）
      进程和线程是包含关系，但是多任务既可以由多进程实现，可以由单进程内的多线程实现，还可以混合多进程+多线程。

      具体使用哪种，需要考虑到进程和线程的特点。

      和多线程相比，多进程的缺点在于：
        - 创建进程比创建线程开销大，尤其是在windows系统上。
        - 进程间的通信比线程间的通信要慢，因为线程间通信就是读写同一个变量，速度很快。
      
      而多进程的优点在于：
        - 多进程稳定性比多线程高，因为在多进程的情况下一个进程崩溃不会影响到其他进程，
        - 而在多线程的情况下，任何一个线程崩溃会直接导致整个进程崩溃。

  * 多线程（java）
      java语言内置了多线程的支持： 一个java程序实际上是一个JVM进程，JVM进程用一个主线程来执行main()方法，在main()方法内部，我们又可以启动多个线程。此外，JVM还有负责垃圾回收的其他工作线程等。

      因此，对于大多数java程序来说，我们说多任务，实际上是说如何使用多线程实现多任务。

      和单线程相比，多线程编程的特点在于： 
        - 多线程经常需要读写共享数据，并且需要同步。
        - 例如，播放电影时，就必须由一个线程播放视频，另一个线程播放音频，两个线程需要协调运行，否则画面和声音就不同步。因此，多线程编程的复杂度高，调试更加困难。
      
      java多线程编程的特点又在于：
        - 多线程模型 是java程序最基本的并发模型。
        - 后续 读写网络、数据库、Web开发等 都依赖java多线程模型。



  * 进程：
    - 首先了解一下：
      1. 我们都知道计算机的核心是[CPU]，它承担了所有的计算任务。
      2. [操作系统]是计算机的管理者，它负责任务的调度，资源的分配和管理，统领整个计算机硬件。
      3. [应用程序]是具有某种功能的程序，程序是运行于操作系统之上的。

    - 那么进程和它们有什么关系呢？：
      1. [进程]是一个具有一定独立功能的程序在一个数据集上的一次动态执行的过程，是操作系统进行资源分配和调度的一个独立单位，是应用程序运行的载体。
      2. [进程]是一种抽象的概念，从来没有统一的标准定义。[进程]一般由程序，数据集合和进程控制块三部分组成。
      3. 程序用于描述[进程]要完成的功能，是控制进程执行的指令集；数据集合是程序在执行时所需要的数据和工作区；程序控制块包含进程的描述信息和控制信息,是进程存在的唯一标志。

    - [进程]具有的特征：
      动态性：进程是程序的一次执行过程，是临时的，有生命期的，是动态产生，动态消亡的；
      并发性：任何进程都可以同其他进程一起并发执行；
      独立性：进程是系统进行资源分配和调度的一个独立单位；
      结构性：进程由程序，数据集合和进程控制块三部分组成

  * 线程： 
    在早期的操作系统中并没有线程的概念，进程是拥有资源和独立运行的最小单位，也是程序执行的最小单位。
    任务调度采用的是时间片轮转的抢占式调度方式，而进程是任务调度的最小单位，每个进程有各自独立的一块内存，使得各个进程之间内存地址相互隔离。

    后来，随着计算机的发展，对CPU的要求越来越高，进程之间的切换开销较大，已经无法满足越来越复杂的程序的要求了。
    于是就发明了线程，线程是程序执行中一个单一的顺序控制流程，是程序执行流的最小单元，是处理器调度和分派的基本单位。
    一个进程可以有一个或多个线程，各个线程之间共享程序的内存空间(也就是所在进程的内存空间)。
    一个标准的线程由线程ID，当前指令指针PC，寄存器和堆栈组成。
    而进程由内存空间(代码，数据，进程空间，打开的文件)和一个或多个线程组成。

  * 进程与线程的区别
    1. 线程是程序执行的最小单位，而进程是操作系统分配资源的最小单位；
    2. 一个进程由一个或多个线程组成，线程是一个进程中代码的不同执行路线
    3. 进程之间相互独立，但同一进程下的各个线程之间共享程序的内存空间(包括代码段，数据集，堆等)及一些进程级的资源(如打开文件和信号等)，某进程内的线程在其他进程不可见；
    4. 调度和切换：线程上下文切换比进程上下文切换要快得多

    总之，线程和进程都是一种抽象的概念，线程是一种比进程还小的抽象，线程和进程都可用于实现并发。在早期的操作系统中并没有线程的概念，进程是能拥有资源和独立运行的最小单位，也是程序执行的最小单位，它相当于一个进程里只有一个线程，进程本身就是线程。所以线程有时被称为轻量级进程后来，随着计算机的发展，对多个任务之间上下文切换的效率要求越来越高，就抽象出一个更小的概念-线程，一般一个进程会有多个(也可以是一个)线程。

  * 任务调度
    大部分操作系统的任务调度是采用时间片轮转的抢占式调度方式，也就是说一个任务执行一小段时间后强制暂停去执行下一个任务，每个任务轮流执行。任务执行的一小段时间叫做时间片，任务正在执行时的状态叫运行状态，任务执行一段时间后强制暂停去执行下一个任务，被暂停的任务就处于就绪状态，等待下一个属于它的时间片的到来。这样每个任务都能得到执行，由于CPU的执行效率非常高，时间片非常短，在各个任务之间快速地切换，给人的感觉就是多个任务在“同时进行”，这也就是我们所说的并发。

  * 为何不使用多进程而是使用多线程？
    1. 线程廉价，线程启动比较快，退出比较快，对系统资源的冲击也比较小。而且线程彼此分享了大部分核心对象(File Handle)的拥有权
    2. 如果使用多重进程，创建开销不可预期，且测试困难。

# 针对浏览器的新打开一个标签页就是一个进程做说明
  - 准确说： 为什么只运行了一个浏览器，为什么有多个进程呢？
    原因：
    * 现代浏览器使用的都是多进程架构，打开一个网页时最少需要四个进程，分别是：
      - 浏览器进程，
      - 网络进程，
      - GPU进程，
      - 页面进程（每打开一个页面，都会开启一个），
      - 插件进程（如果浏览器安装插件了，每个插件都是一个进程）。
      
    * 现在的浏览器为了增强稳定性，使用户有个好的上网体验，每打开一个网页就做为独立进程,当浏览器浏览的某个网页由于某种问题不得不退出的时候，不会影响到你同时打开的其它网页，因为其它网页在其它进程内存空间里，不在同空间。否则，如果不管打开多少网页，只有一个进程，那所有进程都在同一内存空间，那一个网页崩溃的时候，会导致你同时打开的所有网页关掉，那用户体验会非常糟糕的。

总结一下： 
  学过物理的都知道最基本的一个概念： 并联和串联。
  从某一角度来说，进程与进程之间就是并联的关系，相互独立，互不影响，就像并联的灯泡你灭了我还在！而某个进程内的线程与线程之间即为串联的关系，互相关联，互相影响，就像串联的灯泡你短路我也灭了。